<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç®¡ç†è€…ãƒšãƒ¼ã‚¸ï½œæ±äº¬è¨­è¨ˆ</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body { font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; background: #f0f2f5; color: #333; }

    /* â”€â”€ Login â”€â”€ */
    .login-wrapper {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #1ab3c8 0%, #0e7a8a 100%);
    }
    .login-card {
      background: #fff;
      border-radius: 16px;
      padding: 52px 48px 44px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 12px 40px rgba(0,0,0,.18);
    }
    .login-logo {
      text-align: center;
      font-size: 26px;
      font-weight: 900;
      color: #1ab3c8;
      margin-bottom: 6px;
    }
    .login-logo span { color: #333; }
    .login-subtitle {
      text-align: center;
      font-size: 13px;
      color: #888;
      margin-bottom: 36px;
    }
    .login-label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      color: #555;
      margin-bottom: 6px;
      margin-top: 18px;
    }
    .login-input {
      width: 100%;
      border: 1.5px solid #ddd;
      border-radius: 8px;
      padding: 13px 14px;
      font-size: 14px;
      outline: none;
      transition: border-color .2s;
      font-family: inherit;
    }
    .login-input:focus { border-color: #1ab3c8; }
    .login-btn {
      display: block;
      width: 100%;
      margin-top: 28px;
      background: #1ab3c8;
      color: #fff;
      font-size: 15px;
      font-weight: 700;
      padding: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      letter-spacing: .04em;
      transition: background .2s;
    }
    .login-btn:hover { background: #13a0b4; }
    .login-error {
      display: none;
      margin-top: 14px;
      text-align: center;
      font-size: 13px;
      color: #e05555;
      background: #fff0f0;
      border-radius: 6px;
      padding: 8px;
    }

    /* â”€â”€ Dashboard layout â”€â”€ */
    .dashboard { display: none; min-height: 100vh; }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0; left: 0; bottom: 0;
      width: 220px;
      background: #1e2633;
      color: #fff;
      display: flex;
      flex-direction: column;
      z-index: 50;
    }
    .sidebar-logo {
      padding: 24px 20px 20px;
      font-size: 20px;
      font-weight: 900;
      color: #1ab3c8;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .sidebar-logo span { color: rgba(255,255,255,.7); font-size: 12px; display: block; margin-top: 2px; font-weight: 400; }
    .sidebar-nav { flex: 1; padding: 16px 0; }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      font-size: 14px;
      color: rgba(255,255,255,.65);
      cursor: pointer;
      transition: background .15s, color .15s;
      border-left: 3px solid transparent;
    }
    .nav-item:hover { background: rgba(255,255,255,.06); color: #fff; }
    .nav-item.active { background: rgba(26,179,200,.15); color: #1ab3c8; border-left-color: #1ab3c8; }
    .nav-icon { font-size: 16px; }
    .sidebar-footer {
      padding: 16px 20px;
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .logout-btn {
      width: 100%;
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.7);
      border: none;
      border-radius: 6px;
      padding: 10px;
      cursor: pointer;
      font-size: 13px;
      font-family: inherit;
      transition: background .2s;
    }
    .logout-btn:hover { background: rgba(255,255,255,.15); color: #fff; }

    /* Main area */
    .main {
      margin-left: 220px;
      padding: 32px 36px;
      min-height: 100vh;
    }
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 28px;
    }
    .page-title {
      font-size: 22px;
      font-weight: 800;
      color: #222;
    }
    .page-title span { font-size: 14px; font-weight: 400; color: #888; margin-left: 10px; }

    /* Panel */
    .panel {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 14px rgba(0,0,0,.06);
      overflow: hidden;
      margin-bottom: 28px;
    }
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 28px;
      border-bottom: 1px solid #f0f0f0;
    }
    .panel-title { font-size: 16px; font-weight: 700; }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 700;
      padding: 9px 18px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-family: inherit;
      transition: all .2s;
    }
    .btn-primary { background: #1ab3c8; color: #fff; }
    .btn-primary:hover { background: #13a0b4; }
    .btn-danger { background: #fff0f0; color: #e05555; }
    .btn-danger:hover { background: #ffe0e0; }
    .btn-edit { background: #f0f8ff; color: #1a7bc8; }
    .btn-edit:hover { background: #ddeeff; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }

    /* Table */
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    thead tr { background: #f8f9fb; }
    th { text-align: left; font-size: 12px; color: #888; font-weight: 700; padding: 14px 20px; white-space: nowrap; }
    td { padding: 16px 20px; font-size: 14px; border-top: 1px solid #f0f0f0; vertical-align: middle; }
    tr:hover td { background: #fafcff; }
    .prop-img-thumb {
      width: 72px; height: 52px;
      object-fit: cover;
      border-radius: 6px;
    }
    .price-cell { font-weight: 800; color: #1ab3c8; font-size: 15px; }
    .badge {
      display: inline-block;
      font-size: 11px;
      font-weight: 700;
      padding: 3px 10px;
      border-radius: 20px;
    }
    .badge-sale { background: #e6fff5; color: #0a8a55; }
    .badge-sold { background: #f0f0f0; color: #999; }
    .empty-row td {
      text-align: center;
      padding: 52px;
      color: #aaa;
      font-size: 14px;
    }

    /* Modal overlay */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      z-index: 200;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: #fff;
      border-radius: 16px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 16px 50px rgba(0,0,0,.22);
      animation: modalIn .2s ease;
    }
    @keyframes modalIn { from { opacity: 0; transform: scale(.95) translateY(12px); } to { opacity: 1; transform: none; } }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 22px 28px;
      border-bottom: 1px solid #f0f0f0;
    }
    .modal-title { font-size: 17px; font-weight: 800; }
    .modal-close {
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
      color: #aaa;
      line-height: 1;
      transition: color .15s;
    }
    .modal-close:hover { color: #333; }
    .modal-body { padding: 24px 28px 28px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-group { margin-bottom: 18px; }
    .form-group.full { grid-column: 1 / -1; }
    .f-label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      color: #555;
      margin-bottom: 6px;
    }
    .f-label .req { color: #e05555; margin-left: 3px; }
    .f-input, .f-select {
      width: 100%;
      border: 1.5px solid #e0e0e0;
      border-radius: 7px;
      padding: 11px 13px;
      font-size: 14px;
      outline: none;
      font-family: inherit;
      transition: border-color .2s;
      background: #fff;
    }
    .f-input:focus, .f-select:focus { border-color: #1ab3c8; }
    .img-preview-wrap {
      margin-top: 10px;
      height: 140px;
      border: 2px dashed #e0e0e0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #fafafa;
    }
    .img-preview-wrap img { width: 100%; height: 100%; object-fit: cover; border-radius: 6px; }
    .img-placeholder { font-size: 13px; color: #bbb; text-align: center; }
    .modal-footer {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding: 16px 28px 24px;
    }
    .btn-cancel { background: #f0f0f0; color: #666; }
    .btn-cancel:hover { background: #e4e4e4; }

    /* Stats cards */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 28px;
    }
    .stat-card {
      background: #fff;
      border-radius: 12px;
      padding: 22px 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,.05);
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .stat-icon {
      width: 48px; height: 48px;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
    }
    .stat-icon.cyan { background: #e6f9fc; }
    .stat-icon.green { background: #e6fff5; }
    .stat-icon.orange { background: #fff5e6; }
    .stat-info .num { font-size: 26px; font-weight: 900; color: #222; }
    .stat-info .label { font-size: 12px; color: #888; margin-top: 2px; }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 28px; right: 28px;
      background: #222;
      color: #fff;
      padding: 13px 22px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      transform: translateY(12px);
      transition: all .3s;
      z-index: 300;
      pointer-events: none;
    }
    .toast.show { opacity: 1; transform: none; }
    .toast.success { background: #0a8a55; }
    .toast.error { background: #e05555; }

    /* Section tabs */
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Confirm dialog */
    .confirm-btns { display: flex; gap: 10px; justify-content: center; margin-top: 18px; }

    /* Form section headings */
    .form-section-heading {
      grid-column: 1 / -1;
      font-size: 12px;
      font-weight: 800;
      color: #1ab3c8;
      text-transform: uppercase;
      letter-spacing: .08em;
      padding: 8px 0 4px;
      border-bottom: 1.5px solid #e6f9fc;
      margin-bottom: 4px;
    }
    /* Checkbox grid */
    .checkbox-grid {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .cb-item {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f8f9fb;
      border: 1.5px solid #e8e8e8;
      border-radius: 8px;
      padding: 9px 12px;
      cursor: pointer;
      transition: border-color .15s, background .15s;
      font-size: 13px;
      color: #444;
      user-select: none;
    }
    .cb-item:hover { border-color: #1ab3c8; background: #f0fbfd; }
    .cb-item input[type=checkbox] { accent-color: #1ab3c8; width: 15px; height: 15px; cursor: pointer; }
    .cb-item.checked { border-color: #1ab3c8; background: #e6f9fc; color: #0e7a8a; font-weight: 700; }

    /* â”€â”€ Agent Management â”€â”€ */
    .agent-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 18px; padding: 24px; }
    .agent-card { background: #fff; border-radius: 12px; border: 1px solid #e8eaf0; padding: 22px 18px 18px; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,.04); }
    .agent-card-avatar { width: 76px; height: 76px; border-radius: 50%; overflow: hidden; border: 3px solid #1ab3c8; flex-shrink: 0; }
    .agent-card-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .agent-card-name { font-weight: 700; font-size: 15px; color: #1e2633; margin-top: 4px; }
    .agent-card-role { font-size: 12px; color: #888; }
    .agent-card-contact { font-size: 11px; color: #666; line-height: 1.6; }
    .agent-card-actions { display: flex; gap: 8px; margin-top: 10px; }
    .agent-sel-avatar { width: 22px; height: 22px; border-radius: 50%; object-fit: cover; vertical-align: middle; margin-right: 6px; }
    .tbl-agent { display: flex; align-items: center; gap: 6px; font-size: 12px; white-space: nowrap; }
    .tbl-agent img { width: 26px; height: 26px; border-radius: 50%; object-fit: cover; border: 2px solid #e0e0e0; }

    @media (max-width: 900px) {
      .sidebar { width: 60px; }
      .sidebar-logo, .nav-item span, .sidebar-footer { display: none; }
      .nav-item { justify-content: center; padding: 14px; }
      .main { margin-left: 60px; padding: 20px 16px; }
      .stats-row { grid-template-columns: 1fr; }
      .form-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="login-wrapper" id="loginScreen">
  <div class="login-card">
    <div class="login-logo">æ±äº¬è¨­è¨ˆ<span>.</span></div>
    <p class="login-subtitle">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</p>

    <label class="login-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
    <input class="login-input" type="text" id="loginUser" placeholder="admin" autocomplete="username" />

    <label class="login-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input class="login-input" type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />

    <button class="login-btn" onclick="doLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <div class="login-error" id="loginError">ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚</div>
    <p style="text-align:center;font-size:11px;color:#bbb;margin-top:18px;">ãƒ‡ãƒ¢ç”¨ï¼šadmin / admin123</p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="dashboard" id="dashboard">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      æ±äº¬è¨­è¨ˆ<span>ç®¡ç†è€…ãƒ‘ãƒãƒ«</span>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="switchTab('properties')" id="tab-properties">
        <span class="nav-icon">ğŸ </span>
        <span>ç‰©ä»¶ç®¡ç†</span>
      </div>
      <div class="nav-item" onclick="switchTab('stats')" id="tab-stats">
        <span class="nav-icon">ğŸ“Š</span>
        <span>çµ±è¨ˆ</span>
      </div>
      <div class="nav-item" onclick="switchTab('agents')" id="tab-agents">
        <span class="nav-icon">ğŸ‘¤</span>
        <span>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†</span>
      </div>
    </nav>
    <div class="sidebar-footer">
      <button class="logout-btn" onclick="doLogout()">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  </aside>

  <!-- Main content -->
  <main class="main">

    <!-- â”€â”€ Properties tab â”€â”€ -->
    <div class="tab-content active" id="content-properties">
      <div class="topbar">
        <div class="page-title">ç‰©ä»¶ç®¡ç† <span id="propCountLabel"></span></div>
        <button class="btn btn-primary" onclick="openAddModal()">ï¼‹ ç‰©ä»¶ã‚’è¿½åŠ </button>
      </div>

      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">ç‰©ä»¶ä¸€è¦§</div>
          <input class="f-input" style="width:220px" type="text" placeholder="ğŸ” æ¤œç´¢..." oninput="filterTable(this.value)" />
        </div>
        <div class="table-wrap">
          <table id="propTable">
            <thead>
              <tr>
                <th>å†™çœŸ</th>
                <th>é§…å</th>
                <th>é¢ç©</th>
                <th>ã‚¿ã‚¤ãƒ—</th>
                <th>ä¾¡æ ¼</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>æ‹…å½“</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="propTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Stats tab â”€â”€ -->
    <div class="tab-content" id="content-stats">
      <div class="topbar">
        <div class="page-title">çµ±è¨ˆ</div>
      </div>

      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon cyan">ğŸ </div>
          <div class="stat-info">
            <div class="num" id="statTotal">0</div>
            <div class="label">ç‰©ä»¶æ•°ï¼ˆåˆè¨ˆï¼‰</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">âœ…</div>
          <div class="stat-info">
            <div class="num" id="statSale">0</div>
            <div class="label">è²©å£²ä¸­</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon orange">ğŸ“¦</div>
          <div class="stat-info">
            <div class="num" id="statSold">0</div>
            <div class="label">å£²å´æ¸ˆ</div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header"><div class="panel-title">ä¾¡æ ¼åˆ†å¸ƒï¼ˆä¸‡å††ï¼‰</div></div>
        <div style="padding:28px 28px 16px;" id="chartArea"></div>
      </div>
    </div>

    <!-- â”€â”€ Agents tab â”€â”€ -->
    <div class="tab-content" id="content-agents">
      <div class="topbar">
        <div class="page-title">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†</div>
        <button class="btn btn-primary" onclick="openAddAgentModal()">ï¼‹ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¿½åŠ </button>
      </div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§</div></div>
        <div class="agent-cards" id="agentCards"></div>
      </div>
    </div>

  </main>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• AGENT MODAL â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="agentModal">
  <div class="modal" style="max-width:460px;">
    <div class="modal-header">
      <div class="modal-title" id="agentModalTitle">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¿½åŠ </div>
      <button class="modal-close" onclick="closeAgentModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="aEditId" />
      <div class="form-row">
        <div class="form-group full">
          <label class="f-label">æ°å <span style="color:red">*</span></label>
          <input class="f-input" id="aName" placeholder="ä¾‹ï¼‰ç”°ä¸­ ã•ãã‚‰" />
        </div>
        <div class="form-group full">
          <label class="f-label">å½¹è·ãƒ»å°‚é–€</label>
          <input class="f-input" id="aRole" placeholder="ä¾‹ï¼‰ä¸­å¤ãƒãƒ³ã‚·ãƒ§ãƒ³å°‚é–€" />
        </div>
        <div class="form-group">
          <label class="f-label">é›»è©±ç•ªå·</label>
          <input class="f-input" id="aPhone" placeholder="03-XXXX-XXXX" />
        </div>
        <div class="form-group">
          <label class="f-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input class="f-input" id="aEmail" placeholder="name@example.com" />
        </div>
        <div class="form-group full">
          <label class="f-label">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸURL</label>
          <input class="f-input" id="aImg" placeholder="https://..." oninput="previewAgentImg(this.value)" />
          <div class="img-preview-wrap" id="agentImgPreview" style="display:flex;align-items:center;justify-content:center;min-height:90px;">
            <div class="img-placeholder">URLã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" onclick="closeAgentModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="saveAgent()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• ADD/EDIT MODAL â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="propModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">ç‰©ä»¶ã‚’è¿½åŠ </div>
      <button class="modal-close" onclick="closeModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="editId" />
      <div class="form-row">

        <!-- â–¸ åŸºæœ¬æƒ…å ± -->
        <div class="form-section-heading">ğŸ“‹ åŸºæœ¬æƒ…å ±</div>

        <div class="form-group">
          <label class="f-label">é§…å <span class="req">*</span></label>
          <input class="f-input" id="fStation" placeholder="ä¾‹ï¼‰æ¸‹è°·é§…" />
        </div>
        <div class="form-group">
          <label class="f-label">é–“å–ã‚Š <span class="req">*</span></label>
          <select class="f-select" id="fType">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>1R</option><option>1K</option><option>1DK</option>
            <option>1LDK</option><option>2LDK</option><option>3LDK</option>
            <option>4LDK</option><option>5LDK+</option>
          </select>
        </div>
        <div class="form-group">
          <label class="f-label">å°‚æœ‰é¢ç©ï¼ˆã¡ï¼‰ <span class="req">*</span></label>
          <input class="f-input" id="fArea" type="number" step="0.01" placeholder="ä¾‹ï¼‰65.5" />
        </div>
        <div class="form-group">
          <label class="f-label">ãƒãƒ«ã‚³ãƒ‹ãƒ¼é¢ç©ï¼ˆã¡ï¼‰</label>
          <input class="f-input" id="fBalcony" type="number" step="0.01" placeholder="ä¾‹ï¼‰8.2" />
        </div>
        <div class="form-group">
          <label class="f-label">è²©å£²ä¾¡æ ¼ï¼ˆä¸‡å††ï¼‰ <span class="req">*</span></label>
          <input class="f-input" id="fPrice" type="number" placeholder="ä¾‹ï¼‰5800" />
        </div>
        <div class="form-group">
          <label class="f-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
          <select class="f-select" id="fStatus">
            <option value="sale">è²©å£²ä¸­</option>
            <option value="sold">å£²å´æ¸ˆ</option>
          </select>
        </div>
        <div class="form-group">
          <label class="f-label">ç®¡ç†è²»ï¼ˆæœˆé¡ãƒ»å††ï¼‰</label>
          <input class="f-input" id="fManage" type="number" placeholder="ä¾‹ï¼‰12000" />
        </div>
        <div class="form-group">
          <label class="f-label">ä¿®ç¹•ç©ç«‹é‡‘ï¼ˆæœˆé¡ãƒ»å††ï¼‰</label>
          <input class="f-input" id="fRepair" type="number" placeholder="ä¾‹ï¼‰8000" />
        </div>

        <!-- â–¸ å»ºç‰©ãƒ»æ‰€åœ¨éšæƒ…å ± -->
        <div class="form-section-heading">ğŸ¢ å»ºç‰©ãƒ»æ‰€åœ¨éšæƒ…å ±</div>

        <div class="form-group">
          <label class="f-label">ç¯‰å¹´æ•°ï¼ˆå¹´ï¼‰</label>
          <input class="f-input" id="fAge" type="number" placeholder="ä¾‹ï¼‰15" />
        </div>
        <div class="form-group">
          <label class="f-label">æ‰€åœ¨éš</label>
          <input class="f-input" id="fFloor" type="number" placeholder="ä¾‹ï¼‰8" />
        </div>
        <div class="form-group">
          <label class="f-label">ç·éšæ•°</label>
          <input class="f-input" id="fTotalFloor" type="number" placeholder="ä¾‹ï¼‰14" />
        </div>
        <div class="form-group">
          <label class="f-label">æœå‘ï¼ˆå‘ãï¼‰</label>
          <select class="f-select" id="fDirection">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="å—">å—</option>
            <option value="å—æ±">å—æ±</option>
            <option value="æ±">æ±</option>
            <option value="åŒ—æ±">åŒ—æ±</option>
            <option value="åŒ—">åŒ—</option>
            <option value="åŒ—è¥¿">åŒ—è¥¿</option>
            <option value="è¥¿">è¥¿</option>
            <option value="å—è¥¿">å—è¥¿</option>
          </select>
        </div>
        <div class="form-group">
          <label class="f-label">å»ºç‰©æ§‹é€ </label>
          <select class="f-select" id="fStructure">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="RC">RCï¼ˆé‰„ç­‹ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆé€ ï¼‰</option>
            <option value="SRC">SRCï¼ˆé‰„éª¨é‰„ç­‹ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆé€ ï¼‰</option>
            <option value="é‰„éª¨é€ ">é‰„éª¨é€ </option>
            <option value="æœ¨é€ ">æœ¨é€ </option>
            <option value="è»½é‡é‰„éª¨é€ ">è»½é‡é‰„éª¨é€ </option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label class="f-label">åœŸåœ°æ¨©åˆ©</label>
          <select class="f-select" id="fLandRight">
            <option value="æ‰€æœ‰æ¨©">æ‰€æœ‰æ¨©</option>
            <option value="å€Ÿåœ°æ¨©">å€Ÿåœ°æ¨©</option>
            <option value="åœ°ä¸Šæ¨©">åœ°ä¸Šæ¨©</option>
          </select>
        </div>
        <div class="form-group">
          <label class="f-label">å…¥å±…æ™‚æœŸ</label>
          <select class="f-select" id="fMoveIn">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="å³å…¥å±…å¯">å³å…¥å±…å¯</option>
            <option value="ç›¸è«‡">ç›¸è«‡</option>
            <option value="2ãƒ¶æœˆä»¥å†…">2ãƒ¶æœˆä»¥å†…</option>
            <option value="3ãƒ¶æœˆä»¥å†…">3ãƒ¶æœˆä»¥å†…</option>
            <option value="æœªå®š">æœªå®š</option>
          </select>
        </div>
        <div class="form-group">
          <label class="f-label">é§è»Šå ´</label>
          <select class="f-select" id="fParking">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="ã‚ã‚Šï¼ˆç©ºæœ‰ï¼‰">ã‚ã‚Šï¼ˆç©ºæœ‰ï¼‰</option>
            <option value="ã‚ã‚Šï¼ˆç©ºç„¡ï¼‰">ã‚ã‚Šï¼ˆç©ºç„¡ï¼‰</option>
            <option value="è¿‘éš£">è¿‘éš£</option>
            <option value="ãªã—">ãªã—</option>
          </select>
        </div>

        <!-- â–¸ è¨­å‚™ãƒ»ç‰¹å¾´ -->
        <div class="form-section-heading">âš™ï¸ è¨­å‚™ãƒ»ç‰¹å¾´</div>

        <div class="checkbox-grid" id="featuresGrid">
          <!-- dynamically built -->
        </div>

        <!-- â–¸ æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ -->
        <div class="form-section-heading">ğŸ‘¤ æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
        <div class="form-group full">
          <label class="f-label">æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠ</label>
          <select class="f-input" id="fAgent">
            <option value="">-- æœªé¸æŠ --</option>
          </select>
        </div>

        <!-- â–¸ èª¬æ˜ãƒ»ç”»åƒ -->
        <div class="form-section-heading">ğŸ“ èª¬æ˜ãƒ»ç”»åƒ</div>

        <div class="form-group full">
          <label class="f-label">ç‰©ä»¶èª¬æ˜</label>
          <textarea class="f-input" id="fDesc" rows="3" placeholder="ä¾‹ï¼‰ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã®æ˜ã‚‹ã„ç‰©ä»¶ã€‚2023å¹´ã«å†…è£…å…¨é¢ãƒªãƒ•ã‚©ãƒ¼ãƒ ã€‚" style="resize:vertical;"></textarea>
        </div>
        <div class="form-group full">
          <label class="f-label">ç”»åƒURL</label>
          <input class="f-input" id="fImg" placeholder="https://..." oninput="previewImg(this.value)" />
          <div class="img-preview-wrap" id="imgPreview">
            <div class="img-placeholder">URLã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
          </div>
        </div>

      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="saveProperty()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• CONFIRM MODAL â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="confirmModal">
  <div class="modal" style="max-width:380px;">
    <div class="modal-header">
      <div class="modal-title">å‰Šé™¤ã®ç¢ºèª</div>
      <button class="modal-close" onclick="closeConfirm()">Ã—</button>
    </div>
    <div class="modal-body" style="text-align:center;padding-top:28px;">
      <div style="font-size:36px;margin-bottom:14px;">ğŸ—‘ï¸</div>
      <p style="font-size:15px;color:#444;">ã“ã®ç‰©ä»¶ã‚’å‰Šé™¤ã—ã¦ã‚ˆã„ã§ã™ã‹ï¼Ÿ<br>ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚</p>
      <div class="confirm-btns">
        <button class="btn btn-cancel" onclick="closeConfirm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-danger" id="confirmDeleteBtn">å‰Šé™¤ã™ã‚‹</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  FEATURES (è¨­å‚™) CONFIG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const FEATURES = [
    { key: 'floorHeating',   label: 'ğŸ”¥ åºŠæš–æˆ¿' },
    { key: 'allElectric',    label: 'âš¡ ã‚ªãƒ¼ãƒ«é›»åŒ–' },
    { key: 'systemKitchen',  label: 'ğŸ³ ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒƒãƒãƒ³',  },
    { key: 'dishwasher',     label: 'ğŸ«§ é£Ÿæ´—æ©Ÿ' },
    { key: 'reheating',      label: 'â™¨ï¸ è¿½ã„ç„šã' },
    { key: 'bathDryer',      label: 'ğŸ’¨ æµ´å®¤ä¹¾ç‡¥æ©Ÿ' },
    { key: 'separateBath',   label: 'ğŸ› ç‹¬ç«‹æµ´å®¤ãƒ»æ´—é¢' },
    { key: 'washletToilet',  label: 'ğŸš½ æ¸©æ°´æ´—æµ„ä¾¿åº§' },
    { key: 'autoLock',       label: 'ğŸ”’ ã‚ªãƒ¼ãƒˆãƒ­ãƒƒã‚¯' },
    { key: 'elevator',       label: 'ğŸ›— ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼' },
    { key: 'deliveryBox',    label: 'ğŸ“¦ å®…é…ãƒœãƒƒã‚¯ã‚¹' },
    { key: 'concierge',      label: 'ğŸ‘¤ ç®¡ç†äººå¸¸é§' },
    { key: 'petOk',          label: 'ğŸ¾ ãƒšãƒƒãƒˆå¯' },
    { key: 'instrumentOk',   label: 'ğŸµ æ¥½å™¨ç›¸è«‡å¯' },
    { key: 'renovation',     label: 'ğŸ”¨ ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆ' },
    { key: 'doubleGlazing',  label: 'ğŸªŸ äºŒé‡çª“ãƒ»è¤‡å±¤ã‚¬ãƒ©ã‚¹' },
    { key: 'airCon',         label: 'â„ï¸ ã‚¨ã‚¢ã‚³ãƒ³' },
    { key: 'ceilingHeight',  label: 'ğŸ“ å¤©äº•é«˜ï¼ˆ2.4mä»¥ä¸Šï¼‰' },
    { key: 'cornerUnit',     label: 'ğŸ“ è§’éƒ¨å±‹' },
    { key: 'topFloor',       label: 'ğŸŒ† æœ€ä¸Šéš' },
    { key: 'storageRoom',    label: 'ğŸ—„ï¸ å°‚ç”¨å€‰åº«ã‚ã‚Š' },
    { key: 'bikeParking',    label: 'ğŸš² é§è¼ªå ´' },
    { key: 'freeInternet',   label: 'ğŸ“¶ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆç„¡æ–™' },
    { key: 'solar',          label: 'â˜€ï¸ å¤ªé™½å…‰ç™ºé›»' },
  ];

  function buildFeaturesGrid(checkedKeys) {
    const grid = document.getElementById('featuresGrid');
    grid.innerHTML = FEATURES.map(f => `
      <label class="cb-item ${checkedKeys.includes(f.key) ? 'checked' : ''}" onclick="toggleCb(this)">
        <input type="checkbox" name="feature" value="${f.key}" ${checkedKeys.includes(f.key) ? 'checked' : ''} />
        ${f.label}
      </label>
    `).join('');
  }

  function toggleCb(label) {
    const cb = label.querySelector('input');
    cb.checked = !cb.checked;
    label.classList.toggle('checked', cb.checked);
  }

  function getCheckedFeatures() {
    return [...document.querySelectorAll('#featuresGrid input[type=checkbox]:checked')].map(c => c.value);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  AUTH
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const CREDENTIALS = { user: 'admin', pass: 'admin123' };

  function doLogin() {
    const u = document.getElementById('loginUser').value.trim();
    const p = document.getElementById('loginPass').value;
    if (u === CREDENTIALS.user && p === CREDENTIALS.pass) {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('dashboard').style.display = 'flex';
      renderTable();
      updateStats();
    } else {
      document.getElementById('loginError').style.display = 'block';
    }
  }
  document.getElementById('loginPass').addEventListener('keydown', e => {
    if (e.key === 'Enter') doLogin();
  });

  function doLogout() {
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('loginUser').value = '';
    document.getElementById('loginPass').value = '';
    document.getElementById('loginError').style.display = 'none';
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  DATA (localStorage)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const STORE_KEY = 'tokyoSekkei_properties';
  const AGENTS_KEY = 'tokyoSekkei_agents';

  const DEFAULT_AGENTS = [
    { id: 1, name: 'ç”°ä¸­ ã•ãã‚‰', role: 'ä¸­å¤ãƒãƒ³ã‚·ãƒ§ãƒ³å°‚é–€', phone: '03-1234-5678', email: 'tanaka@tokyo-sekkei.jp', img: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=80&q=80' },
    { id: 2, name: 'éˆ´æœ¨ å¥å¤ª',   role: 'ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ‹…å½“',   phone: '03-2345-6789', email: 'suzuki@tokyo-sekkei.jp', img: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=80&q=80' },
    { id: 3, name: 'å±±ç”° ç¾å’Œ',   role: 'æŠ•è³‡ç‰©ä»¶å°‚é–€',         phone: '03-3456-7890', email: 'yamada@tokyo-sekkei.jp', img: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&q=80' },
  ];

  function loadAgents() { const r = localStorage.getItem(AGENTS_KEY); return r ? JSON.parse(r) : JSON.parse(JSON.stringify(DEFAULT_AGENTS)); }
  function saveAgents(list) { localStorage.setItem(AGENTS_KEY, JSON.stringify(list)); }
  function nextAgentId() { const list = loadAgents(); return list.length ? Math.max(...list.map(a => a.id)) + 1 : 1; }

  const DEFAULT_PROPS = [
    { id: 1, station: 'ç¥æ³‰é§…',    area: 69, type: '1LDK', price: 7180, status: 'sale', age: 12, desc: 'ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿', img: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=600&q=80', agentId: 1 },
    { id: 2, station: 'ä¸­ç›®é»’é§…',  area: 79, type: '2LDK', price: 6480, status: 'sale', age: 18, desc: 'é§…å¾’æ­©5åˆ†',         img: 'https://images.unsplash.com/photo-1600566753086-00f18fb6b3ea?w=600&q=80', agentId: 2 },
    { id: 3, station: 'è­·å›½å¯ºé§…',  area: 90, type: '3LDK', price: 7780, status: 'sale', age: 8,  desc: 'æœ€ä¸Šéšãƒ»è§’éƒ¨å±‹',   img: 'https://images.unsplash.com/photo-1556909172-54557c7e4fb7?w=600&q=80', agentId: 1 },
    { id: 4, station: 'è¥¿é¦¬è¾¼é§…',  area: 61, type: '3LDK', price: 4690, status: 'sale', age: 20, desc: 'å¤§å‹ãƒªãƒãƒ™æ¸ˆã¿',   img: 'https://images.unsplash.com/photo-1600573472550-8090b5e0745e?w=600&q=80', agentId: 3 },
    { id: 5, station: 'ä¸‰è»’èŒ¶å±‹é§…',area: 57, type: '2LDK', price: 4790, status: 'sold', age: 14, desc: 'ãƒšãƒƒãƒˆå¯',         img: 'https://images.unsplash.com/photo-1556909114-6f4f8c0528a9?w=600&q=80', agentId: 2 },
    { id: 6, station: 'æºã®å£é§…',  area: 62, type: '2LDK', price: 3980, status: 'sale', age: 22, desc: 'å—å‘ãæ—¥å½“ãŸã‚Šè‰¯å¥½',img: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=600&q=80', agentId: 3 },
  ];

  function loadProps() {
    const raw = localStorage.getItem(STORE_KEY);
    return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(DEFAULT_PROPS));
  }

  function saveProps(list) {
    localStorage.setItem(STORE_KEY, JSON.stringify(list));
  }

  function nextId() {
    const list = loadProps();
    return list.length ? Math.max(...list.map(p => p.id)) + 1 : 1;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  TAB SWITCHING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function switchTab(name) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    document.getElementById('content-' + name).classList.add('active');
    document.getElementById('tab-' + name).classList.add('active');
    if (name === 'stats')  updateStats();
    if (name === 'agents') renderAgents();
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  AGENT MANAGEMENT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function populateAgentSelect() {
    const sel = document.getElementById('fAgent');
    const agents = loadAgents();
    sel.innerHTML = '<option value="">-- æœªé¸æŠ --</option>' +
      agents.map(a => `<option value="${a.id}">${a.name}ï¼ˆ${a.role || 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ'}ï¼‰</option>`).join('');
  }

  function renderAgents() {
    const list = loadAgents();
    const container = document.getElementById('agentCards');
    if (!container) return;
    if (list.length === 0) {
      container.innerHTML = '<p style="padding:24px;color:#aaa;">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã„ã¾ã›ã‚“ã€‚è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>';
      return;
    }
    container.innerHTML = list.map(a => `
      <div class="agent-card">
        <div class="agent-card-avatar">
          <img src="${a.img || 'https://via.placeholder.com/76?text=A'}" alt="${a.name}"
               onerror="this.src='https://via.placeholder.com/76?text=A'" />
        </div>
        <div class="agent-card-name">${a.name}</div>
        <div class="agent-card-role">${a.role || ''}</div>
        <div class="agent-card-contact">${a.phone ? 'ğŸ“ ' + a.phone : ''}${a.email ? '<br>âœ‰ï¸ ' + a.email : ''}</div>
        <div class="agent-card-actions">
          <button class="btn btn-edit btn-sm" onclick="openEditAgentModal(${a.id})">âœï¸ ç·¨é›†</button>
          <button class="btn btn-danger btn-sm" onclick="deleteAgent(${a.id})">ğŸ—‘ï¸</button>
        </div>
      </div>
    `).join('');
  }

  function openAddAgentModal() {
    document.getElementById('agentModalTitle').textContent = 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¿½åŠ ';
    document.getElementById('aEditId').value = '';
    ['aName','aRole','aPhone','aEmail','aImg'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('agentImgPreview').innerHTML = '<div class="img-placeholder">URLã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>';
    document.getElementById('agentModal').classList.add('open');
  }

  function openEditAgentModal(id) {
    const agent = loadAgents().find(a => a.id === id);
    if (!agent) return;
    document.getElementById('agentModalTitle').textContent = 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç·¨é›†';
    document.getElementById('aEditId').value = id;
    document.getElementById('aName').value  = agent.name  || '';
    document.getElementById('aRole').value  = agent.role  || '';
    document.getElementById('aPhone').value = agent.phone || '';
    document.getElementById('aEmail').value = agent.email || '';
    document.getElementById('aImg').value   = agent.img   || '';
    previewAgentImg(agent.img);
    document.getElementById('agentModal').classList.add('open');
  }

  function closeAgentModal() {
    document.getElementById('agentModal').classList.remove('open');
  }

  function previewAgentImg(url) {
    const wrap = document.getElementById('agentImgPreview');
    if (!url) {
      wrap.innerHTML = '<div class="img-placeholder">URLã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>';
      return;
    }
    wrap.innerHTML = `<img src="${url}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid #1ab3c8;margin-top:6px;"
      onerror="this.parentElement.innerHTML='<div class=\\'img-placeholder\\'>ç”»åƒã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ</div>'" />`;
  }

  function saveAgent() {
    const name   = document.getElementById('aName').value.trim();
    const role   = document.getElementById('aRole').value.trim();
    const phone  = document.getElementById('aPhone').value.trim();
    const email  = document.getElementById('aEmail').value.trim();
    const img    = document.getElementById('aImg').value.trim();
    const editId = document.getElementById('aEditId').value;
    if (!name) { showToast('æ°åã¯å¿…é ˆã§ã™', 'error'); return; }
    const data = { name, role, phone, email, img };
    let list = loadAgents();
    if (editId) {
      list = list.map(a => a.id === Number(editId) ? { ...a, ...data } : a);
      showToast('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸ âœ…', 'success');
    } else {
      list.push({ id: nextAgentId(), ...data });
      showToast('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ âœ…', 'success');
    }
    saveAgents(list);
    closeAgentModal();
    renderAgents();
  }

  function deleteAgent(id) {
    if (!confirm('ã“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    const list = loadAgents().filter(a => a.id !== id);
    saveAgents(list);
    renderAgents();
    showToast('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  TABLE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  let currentFilter = '';

  function renderTable(filter) {
    filter = (filter || currentFilter || '').toLowerCase();
    currentFilter = filter;
    const list = loadProps();
    const filtered = list.filter(p =>
      p.station.includes(filter) || p.type.toLowerCase().includes(filter) ||
      String(p.price).includes(filter)
    );
    const tbody = document.getElementById('propTbody');
    document.getElementById('propCountLabel').textContent = 'ï¼ˆ' + list.length + 'ä»¶ï¼‰';

    if (filtered.length === 0) {
      tbody.innerHTML = '<tr class="empty-row"><td colspan="7">è©²å½“ã™ã‚‹ç‰©ä»¶ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
      return;
    }

    tbody.innerHTML = filtered.map(p => {
      const floorStr = p.floor ? `${p.floor}/${p.totalFloor || '?'}éš` : 'â€”';
      const dirStr   = p.direction || 'â€”';
      const featureIcons = (p.features || []).slice(0,4).map(k => {
        const f = FEATURES.find(x => x.key === k);
        return f ? `<span title="${f.label.replace(/^\S+\s/,'')}" style="font-size:13px;">${f.label.split(' ')[0]}</span>` : '';
      }).join('');
      const agents = loadAgents();
      const agent = p.agentId ? agents.find(a => a.id === p.agentId) : null;
      const agentCell = agent
        ? `<div class="tbl-agent"><img src="${agent.img || 'https://via.placeholder.com/26?text=A'}" onerror="this.src='https://via.placeholder.com/26?text=A'" /><span>${agent.name}</span></div>`
        : `<span style="color:#ddd;font-size:12px;">æœªé¸æŠ</span>`;
      return `
      <tr>
        <td><img class="prop-img-thumb" src="${p.img || 'https://via.placeholder.com/72x52?text=No+Image'}" alt="" onerror="this.src='https://via.placeholder.com/72x52?text=No+Image'" /></td>
        <td><strong>${p.station}</strong><br><span style="font-size:11px;color:#aaa;">${p.structure || ''}</span></td>
        <td>${p.area}ã¡${p.balcony ? `<br><span style='font-size:11px;color:#aaa;'>ãƒãƒ«ã‚³ãƒ‹ãƒ¼${p.balcony}ã¡</span>` : ''}</td>
        <td>${p.type}<br><span style="font-size:11px;color:#aaa;">${dirStr} / ${floorStr}</span></td>
        <td class="price-cell">${Number(p.price).toLocaleString()}<small style="font-size:11px;font-weight:600;color:#888;margin-left:2px;">ä¸‡å††</small>${p.manage ? `<br><span style='font-size:11px;color:#aaa;font-weight:400;'>ç®¡ç†è²» ${Number(p.manage).toLocaleString()}å††</span>` : ''}</td>
        <td>${featureIcons || '<span style="color:#ddd;">â€”</span>'}<br><span class="badge ${p.status === 'sale' ? 'badge-sale' : 'badge-sold'}" style="margin-top:4px;">${p.status === 'sale' ? 'è²©å£²ä¸­' : 'å£²å´æ¸ˆ'}</span></td>
        <td>${agentCell}</td>
        <td style="display:flex;gap:8px;align-items:center;">
          <button class="btn btn-edit btn-sm" onclick="openEditModal(${p.id})">âœï¸ ç·¨é›†</button>
          <button class="btn btn-danger btn-sm" onclick="confirmDelete(${p.id})">ğŸ—‘ï¸</button>
        </td>
      </tr>
    `}).join('');
  }

  function filterTable(val) { renderTable(val); }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  MODAL
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function openAddModal() {
    document.getElementById('modalTitle').textContent = 'ç‰©ä»¶ã‚’è¿½åŠ ';
    document.getElementById('editId').value = '';
    ['fStation','fArea','fBalcony','fPrice','fManage','fRepair','fAge',
     'fFloor','fTotalFloor','fDesc','fImg'].forEach(id => document.getElementById(id).value = '');
    ['fType','fDirection','fStructure','fMoveIn','fParking'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('fStatus').value = 'sale';
    document.getElementById('fLandRight').value = 'æ‰€æœ‰æ¨©';
    populateAgentSelect();
    document.getElementById('fAgent').value = '';
    buildFeaturesGrid([]);
    setPreview('');
    document.getElementById('propModal').classList.add('open');
  }

  function openEditModal(id) {
    const prop = loadProps().find(p => p.id === id);
    if (!prop) return;
    document.getElementById('modalTitle').textContent = 'ç‰©ä»¶ã‚’ç·¨é›†';
    document.getElementById('editId').value = id;
    document.getElementById('fStation').value    = prop.station;
    document.getElementById('fArea').value        = prop.area;
    document.getElementById('fBalcony').value     = prop.balcony || '';
    document.getElementById('fType').value        = prop.type;
    document.getElementById('fPrice').value       = prop.price;
    document.getElementById('fStatus').value      = prop.status;
    document.getElementById('fManage').value      = prop.manage || '';
    document.getElementById('fRepair').value      = prop.repair || '';
    document.getElementById('fAge').value         = prop.age || '';
    document.getElementById('fFloor').value       = prop.floor || '';
    document.getElementById('fTotalFloor').value  = prop.totalFloor || '';
    document.getElementById('fDirection').value   = prop.direction || '';
    document.getElementById('fStructure').value   = prop.structure || '';
    document.getElementById('fLandRight').value   = prop.landRight || 'æ‰€æœ‰æ¨©';
    document.getElementById('fMoveIn').value      = prop.moveIn || '';
    document.getElementById('fParking').value     = prop.parking || '';
    document.getElementById('fDesc').value        = prop.desc || '';
    document.getElementById('fImg').value         = prop.img || '';
    populateAgentSelect();
    document.getElementById('fAgent').value       = prop.agentId || '';
    buildFeaturesGrid(prop.features || []);
    setPreview(prop.img);
    document.getElementById('propModal').classList.add('open');
  }

  function closeModal() {
    document.getElementById('propModal').classList.remove('open');
  }

  function saveProperty() {
    const station    = document.getElementById('fStation').value.trim();
    const area       = document.getElementById('fArea').value;
    const balcony    = document.getElementById('fBalcony').value;
    const type       = document.getElementById('fType').value;
    const price      = document.getElementById('fPrice').value;
    const status     = document.getElementById('fStatus').value;
    const manage     = document.getElementById('fManage').value;
    const repair     = document.getElementById('fRepair').value;
    const age        = document.getElementById('fAge').value;
    const floor      = document.getElementById('fFloor').value;
    const totalFloor = document.getElementById('fTotalFloor').value;
    const direction  = document.getElementById('fDirection').value;
    const structure  = document.getElementById('fStructure').value;
    const landRight  = document.getElementById('fLandRight').value;
    const moveIn     = document.getElementById('fMoveIn').value;
    const parking    = document.getElementById('fParking').value;
    const desc       = document.getElementById('fDesc').value.trim();
    const img        = document.getElementById('fImg').value.trim();
    const features   = getCheckedFeatures();
    const agentId    = document.getElementById('fAgent').value;
    const editId     = document.getElementById('editId').value;

    if (!station || !area || !type || !price) {
      showToast('å¿…é ˆé …ç›®ï¼ˆé§…åãƒ»é¢ç©ãƒ»é–“å–ã‚Šãƒ»ä¾¡æ ¼ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
      return;
    }

    const data = {
      station, type, status, desc, img, features,
      area: Number(area),
      balcony: balcony ? Number(balcony) : null,
      price: Number(price),
      manage: manage ? Number(manage) : null,
      repair: repair ? Number(repair) : null,
      age: age ? Number(age) : null,
      floor: floor ? Number(floor) : null,
      totalFloor: totalFloor ? Number(totalFloor) : null,
      direction, structure, landRight, moveIn, parking,
      agentId: agentId ? Number(agentId) : null,
    };

    let list = loadProps();
    if (editId) {
      list = list.map(p => p.id === Number(editId) ? { ...p, ...data } : p);
      showToast('ç‰©ä»¶ã‚’æ›´æ–°ã—ã¾ã—ãŸ âœ…', 'success');
    } else {
      list.push({ id: nextId(), ...data });
      showToast('ç‰©ä»¶ã‚’è¿½åŠ ã—ã¾ã—ãŸ âœ…', 'success');
    }
    saveProps(list);
    closeModal();
    renderTable();
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  DELETE CONFIRM
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  let pendingDeleteId = null;

  function confirmDelete(id) {
    pendingDeleteId = id;
    document.getElementById('confirmModal').classList.add('open');
    document.getElementById('confirmDeleteBtn').onclick = () => {
      let list = loadProps().filter(p => p.id !== id);
      saveProps(list);
      closeConfirm();
      renderTable();
      showToast('ç‰©ä»¶ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
    };
  }

  function closeConfirm() {
    document.getElementById('confirmModal').classList.remove('open');
    pendingDeleteId = null;
  }

  // Close modals on overlay click
  ['propModal','confirmModal'].forEach(id => {
    document.getElementById(id).addEventListener('click', function(e) {
      if (e.target === this) {
        this.classList.remove('open');
      }
    });
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  IMAGE PREVIEW
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function previewImg(url) { setPreview(url); }

  function setPreview(url) {
    const wrap = document.getElementById('imgPreview');
    if (url) {
      wrap.innerHTML = `<img src="${url}" alt="preview" onerror="this.parentElement.innerHTML='<div class=img-placeholder>ç”»åƒã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ</div>'" />`;
    } else {
      wrap.innerHTML = '<div class="img-placeholder">URLã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>';
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  STATS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function updateStats() {
    const list = loadProps();
    document.getElementById('statTotal').textContent = list.length;
    document.getElementById('statSale').textContent  = list.filter(p => p.status === 'sale').length;
    document.getElementById('statSold').textContent  = list.filter(p => p.status === 'sold').length;
    renderChart(list);
  }

  function renderChart(list) {
    const area = document.getElementById('chartArea');
    if (!list.length) { area.innerHTML = '<p style="color:#aaa;text-align:center;padding:20px">ãƒ‡ãƒ¼ã‚¿ãªã—</p>'; return; }
    const max = Math.max(...list.map(p => p.price));
    const barColor = p => p.status === 'sale' ? '#1ab3c8' : '#ccc';
    area.innerHTML = `
      <div style="display:flex;flex-direction:column;gap:12px;">
        ${list.map(p => `
          <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:110px;font-size:12px;color:#555;text-align:right;white-space:nowrap;">${p.station}</div>
            <div style="flex:1;background:#f0f0f0;border-radius:6px;height:28px;overflow:hidden;">
              <div style="width:${Math.round((p.price/max)*100)}%;height:100%;background:${barColor(p)};border-radius:6px;transition:width .4s;display:flex;align-items:center;padding-left:10px;">
                <span style="font-size:12px;color:#fff;font-weight:700;white-space:nowrap;">${Number(p.price).toLocaleString()}ä¸‡å††</span>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
      <div style="display:flex;gap:20px;margin-top:20px;justify-content:flex-end;font-size:12px;color:#777;">
        <span><span style="display:inline-block;width:12px;height:12px;background:#1ab3c8;border-radius:3px;margin-right:5px;"></span>è²©å£²ä¸­</span>
        <span><span style="display:inline-block;width:12px;height:12px;background:#ccc;border-radius:3px;margin-right:5px;"></span>å£²å´æ¸ˆ</span>
      </div>
    `;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  TOAST
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function showToast(msg, type) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast ' + (type || '');
    setTimeout(() => t.classList.add('show'), 10);
    setTimeout(() => t.classList.remove('show'), 3000);
  }
</script>
</body>
</html>
